<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Calendrier de l'Avent</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      box-sizing: border-box;
    }

    h1 {
      text-align: center;
      margin-bottom: 5px;
    }

    #subtitle {
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 0.95rem;
      color: #9ca3af;
    }

    #today-info {
      margin-bottom: 15px;
      font-size: 0.9rem;
      color: #9ca3af;
    }

    .calendar-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      max-width: 900px;
      width: 100%;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(60px, 1fr));
      gap: 10px;
    }

    .day-button {
      border: none;
      border-radius: 0.75rem;
      padding: 20px 0;
      font-size: 1.4rem;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(135deg, #1f2937, #111827);
      color: #f9fafb;
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.3);
      position: relative;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.2s ease;
    }

    .day-button:hover:not(.locked) {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.35);
      background: linear-gradient(135deg, #111827, #020617);
    }

    .day-button.locked {
      cursor: not-allowed;
      opacity: 0.5;
    }

    .day-label {
      display: block;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .day-number {
      display: block;
    }

    .pieces-container {
      border-radius: 1rem;
      padding: 15px;
      background: rgba(15, 23, 42, 0.9);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .pieces-grid {
      margin-top: 10px;
      display: grid;
      grid-template-columns: repeat(4, minmax(60px, 1fr));
      gap: 6px;
    }

    .piece {
      position: relative;
      border-radius: 0.5rem;
      overflow: hidden;
      height: 70px;
      background: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      color: #9ca3af;
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.2);
    }

    .piece.revealed {
      background-image: linear-gradient(135deg, #22c55e, #0ea5e9);
      color: #022c22;
      font-weight: 700;
    }

    .piece .piece-label {
      position: absolute;
      top: 4px;
      left: 6px;
      font-size: 0.7rem;
      color: #e5e7eb;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
    }

    .piece.locked::after {
      content: "üîí";
      font-size: 1.3rem;
    }

    .piece.revealed::after {
      content: "";
    }

    /* Modal */

    #challenge-modal {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    #challenge-modal.open {
      display: flex;
    }

    .modal-inner {
      background: #020617;
      border-radius: 1rem;
      max-width: 700px;
      width: 100%;
      margin: 10px;
      padding: 20px 20px 16px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 25px 60px rgba(0, 0, 0, 0.8);
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 1.3rem;
    }

    .modal-close {
      border: none;
      background: transparent;
      color: #9ca3af;
      font-size: 1.4rem;
      cursor: pointer;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 0.75rem;
      background: rgba(34, 197, 94, 0.15);
      color: #bbf7d0;
      border: 1px solid rgba(34, 197, 94, 0.6);
      gap: 4px;
    }

    .badge.locked-badge {
      background: rgba(248, 250, 252, 0.05);
      color: #e5e7eb;
      border-color: rgba(148, 163, 184, 0.7);
    }

    .modal-body {
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .modal-section {
      margin-top: 12px;
      margin-bottom: 12px;
      padding: 10px 12px;
      border-radius: 0.75rem;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(55, 65, 81, 0.9);
    }

    .modal-section h3 {
      margin-top: 0;
      margin-bottom: 6px;
      font-size: 0.95rem;
    }

    .small {
      font-size: 0.85rem;
      color: #9ca3af;
    }

    button.primary {
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 0.9rem;
      cursor: pointer;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      font-weight: 600;
      box-shadow: 0 10px 25px rgba(34, 197, 94, 0.25);
      margin-top: 6px;
    }

    button.primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    .error {
      color: #fca5a5;
      font-size: 0.85rem;
      margin-top: 4px;
    }

    .success {
      color: #bbf7d0;
      font-size: 0.9rem;
      margin-top: 4px;
    }

    .timer {
      font-size: 1.3rem;
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco,
        Consolas, "Liberation Mono", "Courier New", monospace;
      margin: 6px 0;
    }

    .code-zone {
      margin-top: 10px;
      border-top: 1px dashed rgba(75, 85, 99, 0.9);
      padding-top: 10px;
    }

    .code-zone label {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 4px;
    }

    .code-input-row {
      display: flex;
      gap: 8px;
      margin-top: 4px;
      flex-wrap: wrap;
    }

    #code-input {
      flex: 1;
      min-width: 120px;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: #020617;
      color: #f9fafb;
    }

    .quiz-question {
      margin-bottom: 8px;
    }

    .quiz-question strong {
      display: block;
      margin-bottom: 4px;
    }

    .quiz-options label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 2px;
    }

    a.link {
      color: #38bdf8;
      text-decoration: none;
    }

    a.link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>Calendrier de l'Avent</h1>
  <p id="subtitle">Pour ma belle et tendre amoureuse üê¥üíö</p>
  <p id="today-info"></p>

  <div class="calendar-container">
    <!-- Grille des jours -->
    <div class="grid" id="days-grid">
      <!-- Boutons g√©n√©r√©s en JS -->
    </div>

    <!-- Cl√© 1 : jours 1 √† 8 -->
    <div class="pieces-container">
      <strong>Fragments de la cl√© Steam n¬∞1 (jours 1 √† 8)</strong>
      <p class="small">
        Chaque jour te donne un fragment de la cl√© Steam n¬∞1. Quand les 8 fragments seront r√©v√©l√©s,
        tu auras la cl√© compl√®te du jeu √† activer sur Steam.
      </p>
      <div class="pieces-grid" id="pieces-grid-1"></div>
      <p id="full-key-1" class="small"></p>
    </div>

    <!-- Cl√© 2 : jours 9 √† 16 -->
    <div class="pieces-container">
      <strong>Fragments de la cl√© Steam n¬∞2 (jours 9 √† 16)</strong>
      <p class="small">
        Encore un jeu ! Les jours 9 √† 16 te donnent une deuxi√®me cl√© Steam, morceau par morceau.
      </p>
      <div class="pieces-grid" id="pieces-grid-2"></div>
      <p id="full-key-2" class="small"></p>
    </div>
  </div>

  <!-- MODAL D√âFIS -->
  <div id="challenge-modal">
    <div class="modal-inner">
      <div class="modal-header">
        <h2>Jour <span id="modal-day"></span></h2>
        <button class="modal-close" id="modal-close" aria-label="Fermer">‚úï</button>
      </div>
      <div class="modal-body">
        <div id="modal-status"></div>
        <div id="challenge-content"></div>
        <div class="code-zone" id="code-zone">
          <p class="small" id="code-hint">
            Quand tu auras trouv√© le code du d√©fi, entre-le ici pour r√©v√©ler le fragment de la cl√©.
          </p>
          <label for="code-input">Code secret du jour :</label>
          <div class="code-input-row">
            <input id="code-input" type="text" autocomplete="off" />
            <button class="primary" id="validate-code">Valider le code</button>
          </div>
          <p id="code-feedback" class=""></p>
        </div>
      </div>
    </div>
  </div>

  <script>
    /********** CONFIG **********/

    const CALENDAR_YEAR = 2025;
    const DEBUG_IGNORE_DATES = false; // mets true pour tester

    const SECRET_CODES = {
      1: "956472",
      2: "682547",
      3: "963258",
      4: "456789",
      5: "159874",
      6: "MAITRE",
      7: "639825",
      8: "854658",
      9: "112233",
      10: "445566",
      11: "778899",
      12: "SEIGNEUR",
      13: "121212",
      14: "343434",
      15: "565656",
      16: "787878"
    };

    // Cl√© 1 (jours 1‚Äì8) ‚Äî tu peux adapter √† ta vraie cl√©
    const STEAM_KEY_FRAGMENTS_1 = {
      1: "BQ",
      2: "AT",
      3: "0-",
      4: "NY",
      5: "0J",
      6: "P-9",
      7: "3T",
      8: "0F"
    };
    const FULL_STEAM_KEY_1 = "BQAT0-NY0JP-93T0F";

    // Cl√© 2 (jours 9‚Äì16) ‚Äî √† adapter aussi
    const STEAM_KEY_FRAGMENTS_2 = {
      9:  "AB",
      10: "CD",
      11: "12",
      12: "EF",
      13: "34",
      14: "GH",
      15: "56",
      16: "IJ"
    };
    const FULL_STEAM_KEY_2 = "ABCD1-2EF34-GH56IJ";

    function getUnlockDate(day) {
      return new Date(CALENDAR_YEAR, 11, day, 0, 0, 0, 0);
    }

    function isDayUnlocked(day) {
      if (DEBUG_IGNORE_DATES) return true;
      const now = new Date();
      return now >= getUnlockDate(day);
    }

    function formatDate(d) {
      return d.toLocaleDateString("fr-FR", {
        weekday: "long",
        day: "2-digit",
        month: "long",
        year: "numeric"
      });
    }

    const STORAGE_KEY = "avent_pieces_revealed_v2";

    function loadRevealedPieces() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return {};
        return JSON.parse(raw);
      } catch {
        return {};
      }
    }

    function saveRevealedPieces(map) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(map));
    }

    let revealedPieces = loadRevealedPieces();

    /********** DOM **********/

    const todayInfoEl = document.getElementById("today-info");
    const daysGridEl = document.getElementById("days-grid");
    const piecesGrid1El = document.getElementById("pieces-grid-1");
    const piecesGrid2El = document.getElementById("pieces-grid-2");
    const fullKey1El = document.getElementById("full-key-1");
    const fullKey2El = document.getElementById("full-key-2");

    const modalEl = document.getElementById("challenge-modal");
    const modalCloseBtn = document.getElementById("modal-close");
    const modalDaySpan = document.getElementById("modal-day");
    const modalStatus = document.getElementById("modal-status");
    const challengeContent = document.getElementById("challenge-content");
    const codeZone = document.getElementById("code-zone");
    const codeInput = document.getElementById("code-input");
    const validateCodeBtn = document.getElementById("validate-code");
    const codeFeedback = document.getElementById("code-feedback");

    let currentDay = null;
    let currentTimerInterval = null;

    /********** INIT **********/

    function initTodayInfo() {
      const now = new Date();
      todayInfoEl.textContent =
        "Nous sommes le " + formatDate(now) +
        (DEBUG_IGNORE_DATES ? " ‚Äî mode TEST activ√© (tous les jours sont d√©verrouill√©s)." : ".");
    }

    function createDayButtons() {
      for (let day = 1; day <= 16; day++) {
        const btn = document.createElement("button");
        btn.className = "day-button";
        btn.dataset.day = String(day);

        const label = document.createElement("span");
        label.className = "day-label";
        label.textContent = "Jour";

        const number = document.createElement("span");
        number.className = "day-number";
        number.textContent = day;

        btn.appendChild(label);
        btn.appendChild(number);

        if (!isDayUnlocked(day)) {
          btn.classList.add("locked");
        }

        btn.addEventListener("click", () => openChallenge(day));

        daysGridEl.appendChild(btn);
      }
    }

    function createPiecesRange(startDay, endDay, gridEl, fragmentMap) {
      for (let day = startDay; day <= endDay; day++) {
        const piece = document.createElement("div");
        piece.className = "piece locked";
        piece.dataset.day = String(day);

        if (revealedPieces[day]) {
          piece.classList.remove("locked");
          piece.classList.add("revealed");
        }

        const label = document.createElement("span");
        label.className = "piece-label";
        label.textContent = "Jour " + day;

        const inner = document.createElement("span");
        if (revealedPieces[day]) {
          inner.textContent = fragmentMap[day] || "(fragment)";
        } else {
          inner.textContent = "Fragment cach√©";
        }

        piece.appendChild(label);
        piece.appendChild(inner);

        gridEl.appendChild(piece);
      }
    }

    function createPieces() {
      createPiecesRange(1, 8, piecesGrid1El, STEAM_KEY_FRAGMENTS_1);
      createPiecesRange(9, 16, piecesGrid2El, STEAM_KEY_FRAGMENTS_2);
      updateFullKeyDisplay1();
      updateFullKeyDisplay2();
    }

    initTodayInfo();
    createDayButtons();
    createPieces();

    /********** MODAL **********/

    function openChallenge(day) {
      currentDay = day;

      const unlocked = isDayUnlocked(day);
      challengeContent.innerHTML = "";
      codeFeedback.textContent = "";
      codeFeedback.className = "";
      codeInput.value = "";

      modalDaySpan.textContent = day;

      if (currentTimerInterval) {
        clearInterval(currentTimerInterval);
        currentTimerInterval = null;
      }

      modalStatus.innerHTML = "";
      const badge = document.createElement("span");
      if (!unlocked) {
        badge.className = "badge locked-badge";
        const d = getUnlockDate(day);
        badge.textContent =
          "üîí Disponible √† partir du " + d.toLocaleDateString("fr-FR", {
            day: "2-digit",
            month: "2-digit"
          });
      } else {
        badge.className = "badge";
        badge.textContent = "‚úÖ D√©fi disponible";
      }
      modalStatus.appendChild(badge);

      if (!unlocked && !DEBUG_IGNORE_DATES) {
        const msg = document.createElement("p");
        msg.className = "small";
        msg.style.marginTop = "8px";
        msg.textContent =
          "Patience‚Ä¶ ce d√©fi se d√©bloquera √† la date pr√©vue. Tu pourras alors r√©v√©ler un fragment de la cl√©.";
        challengeContent.appendChild(msg);
        codeZone.style.display = "none";
      } else {
        renderChallengeContent(day);
        codeZone.style.display = "block";
      }

      modalEl.classList.add("open");
    }

    function closeModal() {
      modalEl.classList.remove("open");
      if (currentTimerInterval) {
        clearInterval(currentTimerInterval);
        currentTimerInterval = null;
      }
      currentDay = null;
    }

    modalCloseBtn.addEventListener("click", closeModal);
    modalEl.addEventListener("click", (e) => {
      if (e.target === modalEl) closeModal();
    });

    /********** D√âFIS **********/

    function renderChallengeContent(day) {
      switch (day) {
        case 1:
          renderDay1();
          break;
        case 2:
          renderDayWithTimer(
            2,
            "Squats pendant 5 minutes",
            "Clique sur ¬´ D√©marrer le d√©fi ¬ª, fais un maximum de squats pendant 5 minutes. Le code appara√Ætra quand le chrono sera termin√©."
          );
          break;
        case 3:
          renderDay3Quiz();
          break;
        case 4:
          renderSimpleValidateDay(
            4,
            "Faire 40 pompes",
            "Quand tu auras termin√© tes 40 pompes, clique sur ¬´ D√©fi accompli ¬ª pour obtenir ton code."
          );
          break;
        case 5:
          renderDayWithTimer(
            5,
            "Corde √† sauter 5 minutes",
            "Clique sur ¬´ D√©marrer le d√©fi ¬ª, fais 5 minutes de corde √† sauter. Le code appara√Ætra √† la fin du chrono."
          );
          break;
        case 6:
          renderDay6();
          break;
        case 7:
          renderSimpleValidateDay(
            7,
            "Une game de League of Legends en toplane",
            "Lance une game de LoL en toplane. Quand tu auras fini ta partie, clique sur ¬´ D√©fi accompli ¬ª pour obtenir ton code."
          );
          break;
        case 8:
          renderSimpleValidateDay(
            8,
            "D√©fi de l'alphabet",
            "D√©fi de l'alphabet : Dessine chaque lettre de l'alphabet avec tes pieds, les abdos bien gain√©s ! Quand c'est fait, clique sur ¬´ D√©fi accompli ¬ª pour obtenir ton code."
          );
          break;

        /* ---- Nouveaux d√©fis 9 √† 16 ---- */

        case 9:
          renderSimpleValidateDay(
            9,
            "Faire croire √† Ambre que tu es tomb√©e enceinte",
            "Mission trolling : fais croire √† Ambre que tu es tomb√©e enceinte. Quand tu auras jou√© ta petite mise en sc√®ne, clique sur ¬´ D√©fi accompli ¬ª."
          );
          break;
        case 10:
          renderSimpleValidateDay(
            10,
            "Tu as gagn√© un massage",
            "Aujourd'hui, tu ne fais rien : tu profites. Quand tu r√©clames ton massage (et que tu l'as re√ßu, √©videmment), clique sur ¬´ D√©fi accompli ¬ª pour r√©cup√©rer ton code."
          );
          break;
        case 11:
          renderSimpleValidateDay(
            11,
            "50 biceps curl √† 10 kg",
            "Fais 50 biceps curl √† 10 kg (tu peux les fractionner, mais pas tricher üòà). Quand c'est fait, clique sur ¬´ D√©fi accompli ¬ª."
          );
          break;
        case 12:
          renderSimpleValidateDay(
            12,
            "Courir 5 km",
            "Va courir 5 km (√† ton rythme, mais sans abandonner). Quand tu as termin√© ta course, clique sur ¬´ D√©fi accompli ¬ª pour obtenir ton code."
          );
          break;
        case 13:
          renderSimpleValidateDay(
            13,
            "Fais un bon repas en amoureux",
            "Organise un petit repas en amoureux : plat, dessert, ambiance cosy‚Ä¶ Quand le repas est fait (ou planifi√© s√©rieusement), clique sur ¬´ D√©fi accompli ¬ª."
          );
          break;
        case 14:
          renderSimpleValidateDay(
            14,
            "Fais-moi une danse",
            "Pr√©pare-moi une petite danse (ridicule, sexy, mignonne, comme tu veux). Quand tu me l'auras faite, clique sur ¬´ D√©fi accompli ¬ª pour ton code."
          );
          break;
        case 15:
          renderSimpleValidateDay(
            15,
            "Petit moment douceur",
            "√âcris une petite liste de 5 choses que tu aimes chez toi, et 5 choses que tu aimes chez nous. Quand c'est fait, clique sur ¬´ D√©fi accompli ¬ª."
          );
          break;
        case 16:
          renderSimpleValidateDay(
            16,
            "Tu gagnes un bon tr√®s sp√©cial",
            "Aujourd'hui, tu gagnes un bon pour un c√¢lin tr√®s intense‚Ä¶ tu gagnes un bon pour un cunni. Quand tu auras d√©cid√© quand l'utiliser, clique sur ¬´ D√©fi accompli ¬ª pour r√©v√©ler le fragment de cl√©."
          );
          break;

        default:
          challengeContent.textContent = "D√©fi non d√©fini pour ce jour.";
      }
    }

    /* Jour 1 : image m√©tadonn√©es */

    function renderDay1() {
      const section = document.createElement("div");
      section.className = "modal-section";

      const title = document.createElement("h3");
      title.textContent = "Jour 1 ‚Äî Chasse au code dans les m√©tadonn√©es";

      const p1 = document.createElement("p");
      p1.textContent =
        "Le code secret du jour se trouve quelque part cach√© dans cette image... Sauras-tu le trouver ?";

      const link = document.createElement("a");
      link.href = "GagaLeOuf.png"; // ton image
      link.download = "GagaLeOuf.png";
      link.textContent = "T√©l√©charger l'image du jour 1";
      link.className = "link";

      const p2 = document.createElement("p");
      p2.className = "small";
      p2.textContent =
        "Astuce : regarde les propri√©t√©s de l'image sur ton ordinateur ou utilise un site pour afficher les m√©tadonn√©es (EXIF, commentaires, etc.).";

      section.appendChild(title);
      section.appendChild(p1);
      section.appendChild(link);
      section.appendChild(p2);

      challengeContent.appendChild(section);
    }

    /* Jours 2 & 5 : timer 5 minutes */

    function renderDayWithTimer(day, titleText, description) {
      const section = document.createElement("div");
      section.className = "modal-section";

      const title = document.createElement("h3");
      title.textContent = titleText;

      const p = document.createElement("p");
      p.textContent = description;

      const timerEl = document.createElement("div");
      timerEl.className = "timer";
      timerEl.textContent = "05:00";

      const info = document.createElement("p");
      info.className = "small";
      info.textContent =
        "Tu peux laisser la page ouverte sur ton t√©l√©phone pendant l'effort.";

      const btn = document.createElement("button");
      btn.className = "primary";
      btn.textContent = "D√©marrer le d√©fi";

      btn.addEventListener("click", () => {
        startTimer(day, 5 * 60, timerEl, btn);
      });

      section.appendChild(title);
      section.appendChild(p);
      section.appendChild(timerEl);
      section.appendChild(info);
      section.appendChild(btn);

      challengeContent.appendChild(section);
    }

    function startTimer(day, totalSeconds, timerEl, startButton) {
      if (currentTimerInterval) {
        clearInterval(currentTimerInterval);
      }

      let remaining = totalSeconds;
      startButton.disabled = true;

      function updateDisplay() {
        const minutes = String(Math.floor(remaining / 60)).padStart(2, "0");
        const seconds = String(remaining % 60).padStart(2, "0");
        timerEl.textContent = minutes + ":" + seconds;
      }

      updateDisplay();

      currentTimerInterval = setInterval(() => {
        remaining--;
        updateDisplay();
        if (remaining <= 0) {
          clearInterval(currentTimerInterval);
          currentTimerInterval = null;
          timerEl.textContent = "Termin√© ! üéâ";
          startButton.disabled = false;
          showFoundCode(day, "Bravo pour le d√©fi ! Voici ton code :");
        }
      }, 1000);
    }

    /* Jours avec simple bouton "D√©fi accompli" */

    function renderSimpleValidateDay(day, titleText, description) {
      const section = document.createElement("div");
      section.className = "modal-section";

      const title = document.createElement("h3");
      title.textContent = titleText;

      const p = document.createElement("p");
      p.textContent = description;

      const btn = document.createElement("button");
      btn.className = "primary";
      btn.textContent = "D√©fi accompli ‚úÖ";

      btn.addEventListener("click", () => {
        showFoundCode(day, "Bien jou√© ! Voici ton code :");
      });

      section.appendChild(title);
      section.appendChild(p);
      section.appendChild(btn);

      challengeContent.appendChild(section);
    }

    /* Jour 3 : quizz cheval */

    function renderDay3Quiz() {
      const section = document.createElement("div");
      section.className = "modal-section";

      const title = document.createElement("h3");
      title.textContent = "Quizz chevaux ‚Äî sp√©cial Galop 6";

      const p = document.createElement("p");
      p.textContent =
        "R√©ponds correctement √† toutes les questions pour obtenir ton code. Tu peux recommencer autant de fois que tu veux.";

      const questions = [
        {
          id: "q1",
          text: "1) En locomotion, qu'est-ce que le 'rassemblement' ?",
          options: [
            "A) Une acc√©l√©ration franche au galop",
            "B) Une attitude o√π le cheval reporte plus de poids sur l'arri√®re-main et raccourcit ses foul√©es",
            "C) Une allure plus rapide que l'extension",
            "D) Une transition montante automatique"
          ],
          correct: "B"
        },
        {
          id: "q2",
          text: "2) Sur un obstacle vertical isol√©, quelle trajectoire est la plus recherch√©e ?",
          options: [
            "A) Un saut tr√®s plat pour aller vite",
            "B) Un saut en cloche, sym√©trique, avec une bonne trajectoire par-dessus la barre",
            "C) Un appel tr√®s loin accompagn√© d'une grande extension de l'encolure",
            "D) Un appel tr√®s pr√®s avec un dos creux"
          ],
          correct: "B"
        },
        {
          id: "q3",
          text: "3) Quel est l'int√©r√™t principal de l'√©paule en dedans au trot ?",
          options: [
            "A) Rendre le cheval plus rapide",
            "B) Travailler la flexion lat√©rale et l'engagement du post√©rieur interne sous la masse",
            "C) Apprendre au cheval √† reculer",
            "D) Faire une figure jolie pour les photos"
          ],
          correct: "B"
        },
        {
          id: "q4",
          text: "4) En ext√©rieur, quel est le signe d'une fourbure d√©butante √† surveiller ?",
          options: [
            "A) Oreilles point√©es vers l'avant",
            "B) Transpiration abondante localis√©e sur l'encolure seulement",
            "C) Cheval camp√©, reportant le poids sur les post√©rieurs et pieds ant√©rieurs chauds et sensibles",
            "D) Queue port√©e tr√®s haute"
          ],
          correct: "C"
        }
      ];

      const quizContainer = document.createElement("div");

      questions.forEach((q) => {
        const qDiv = document.createElement("div");
        qDiv.className = "quiz-question";

        const qTitle = document.createElement("strong");
        qTitle.textContent = q.text;

        const optsDiv = document.createElement("div");
        optsDiv.className = "quiz-options";

        q.options.forEach((optText) => {
          const label = document.createElement("label");
          const radio = document.createElement("input");
          radio.type = "radio";
          radio.name = q.id;
          radio.value = optText[0];

          label.appendChild(radio);
          label.appendChild(document.createTextNode(" " + optText));
          optsDiv.appendChild(label);
        });

        qDiv.appendChild(qTitle);
        qDiv.appendChild(optsDiv);
        quizContainer.appendChild(qDiv);
      });

      const btn = document.createElement("button");
      btn.className = "primary";
      btn.textContent = "Valider le quizz";

      const quizFeedback = document.createElement("p");
      quizFeedback.className = "small";

      btn.addEventListener("click", () => {
        let allAnswered = true;
        let allCorrect = true;

        questions.forEach((q) => {
          const radios = document.querySelectorAll("input[name='" + q.id + "']");
          let chosen = null;
          radios.forEach((r) => {
            if (r.checked) chosen = r.value;
          });
          if (!chosen) {
            allAnswered = false;
          } else if (chosen !== q.correct) {
            allCorrect = false;
          }
        });

        if (!allAnswered) {
          quizFeedback.textContent = "R√©ponds √† toutes les questions avant de valider.";
          quizFeedback.style.color = "#fca5a5";
          return;
        }

        if (!allCorrect) {
          quizFeedback.textContent =
            "Ce n'est pas encore √ßa‚Ä¶ R√©essaie, tu peux le faire ! üê¥";
          quizFeedback.style.color = "#fca5a5";
        } else {
          quizFeedback.textContent = "Parfait ! Toutes les r√©ponses sont correctes. üéâ";
          quizFeedback.style.color = "#bbf7d0";
          showFoundCode(3, "Cheval de concours ! Voici ton code :");
        }
      });

      section.appendChild(title);
      section.appendChild(p);
      section.appendChild(quizContainer);
      section.appendChild(btn);
      section.appendChild(quizFeedback);

      challengeContent.appendChild(section);
    }

    /* Jour 6 : Ma√Ætre + code √† 22h */

    function renderDay6() {
      const section = document.createElement("div");
      section.className = "modal-section";

      const title = document.createElement("h3");
      title.textContent = "M'appeler Ma√Ætre toute la journ√©e";

      const p = document.createElement("p");
      p.textContent =
        "Aujourd'hui, tu dois m'appeler ¬´ Ma√Ætre ¬ª toute la journ√©e. Le code ne sera r√©v√©l√© qu'√† partir de 22h ce soir. üòà";

      const info = document.createElement("p");
      info.className = "small";
      info.textContent =
        "Reviens ici apr√®s 22h pour r√©cup√©rer le code et r√©v√©ler ton fragment de cl√©.";

      const now = new Date();
      const unlockAt = new Date(
        CALENDAR_YEAR,
        11,
        6,
        22,
        0,
        0,
        0
      );

      const msg = document.createElement("p");
      msg.className = "small";

      if (DEBUG_IGNORE_DATES || now >= unlockAt) {
        msg.textContent = "Il est 22h (ou plus) : tu peux r√©cup√©rer ton code !";
        showFoundCode(6, "Voici ton code :");
      } else {
        const remainingMs = unlockAt - now;
        const remainingMin = Math.ceil(remainingMs / (1000 * 60));
        msg.textContent =
          "Encore un peu de patience‚Ä¶ le code sera disponible dans environ " +
          remainingMin +
          " minute(s).";
      }

      section.appendChild(title);
      section.appendChild(p);
      section.appendChild(info);
      section.appendChild(msg);

      challengeContent.appendChild(section);
    }

    /********** GESTION DES CODES / CL√âS **********/

    function showFoundCode(day, message) {
      const code = SECRET_CODES[day];
      const hint = document.getElementById("code-hint");
      hint.textContent = message + " ¬´ " + code + " ¬ª";
      codeInput.value = code;
      codeFeedback.textContent =
        "Tu peux copier le code ci-dessus (ou le retaper) puis cliquer sur ¬´ Valider le code ¬ª pour r√©v√©ler le fragment.";
      codeFeedback.className = "small success";
    }

    validateCodeBtn.addEventListener("click", () => {
      if (!currentDay) return;
      const expected = SECRET_CODES[currentDay];
      const value = codeInput.value.trim().toUpperCase();
      if (!value) {
        codeFeedback.textContent = "Entre un code, sinon la magie ne marche pas. ‚ú®";
        codeFeedback.className = "error";
        return;
      }
      if (value === expected.toUpperCase()) {
        revealPiece(currentDay);
        codeFeedback.textContent =
          "Parfait ! Le fragment du jour " + currentDay + " est maintenant r√©v√©l√©.";
        codeFeedback.className = "success";
      } else {
        codeFeedback.textContent = "Ce code ne correspond pas √† ce jour. R√©essaie !";
        codeFeedback.className = "error";
      }
    });

    function revealPiece(day) {
      revealedPieces[day] = true;
      saveRevealedPieces(revealedPieces);

      let gridEl, fragments;
      if (day >= 1 && day <= 8) {
        gridEl = piecesGrid1El;
        fragments = STEAM_KEY_FRAGMENTS_1;
      } else if (day >= 9 && day <= 16) {
        gridEl = piecesGrid2El;
        fragments = STEAM_KEY_FRAGMENTS_2;
      } else {
        return;
      }

      const piece = gridEl.querySelector('.piece[data-day="' + day + '"]');
      if (piece) {
        piece.classList.remove("locked");
        piece.classList.add("revealed");
        const inner = piece.querySelector("span:not(.piece-label)");
        if (inner) {
          inner.textContent = fragments[day] || "(fragment)";
        }
      }

      updateFullKeyDisplay1();
      updateFullKeyDisplay2();
    }

    function updateFullKeyDisplay1() {
      if (!fullKey1El) return;
      const days = [1, 2, 3, 4, 5, 6, 7, 8];
      const revealedCount = days.filter(d => revealedPieces[d]).length;
      const allRevealed = revealedCount === days.length;

      if (allRevealed) {
        fullKey1El.textContent = "Cl√© Steam n¬∞1 compl√®te : " + FULL_STEAM_KEY_1 + " üéÆ";
      } else {
        fullKey1El.textContent =
          "Fragments r√©v√©l√©s : " + revealedCount + "/" + days.length +
          " ‚Äî continue pour reconstituer la cl√© Steam n¬∞1 !";
      }
    }

    function updateFullKeyDisplay2() {
      if (!fullKey2El) return;
      const days = [9, 10, 11, 12, 13, 14, 15, 16];
      const revealedCount = days.filter(d => revealedPieces[d]).length;
      const allRevealed = revealedCount === days.length;

      if (allRevealed) {
        fullKey2El.textContent = "Cl√© Steam n¬∞2 compl√®te : " + FULL_STEAM_KEY_2 + " üéÆ";
      } else {
        fullKey2El.textContent =
          "Fragments r√©v√©l√©s : " + revealedCount + "/" + days.length +
          " ‚Äî continue pour reconstituer la cl√© Steam n¬∞2 !";
      }
    }
  </script>
</body>
</html>
